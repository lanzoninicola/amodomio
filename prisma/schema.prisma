// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Product {
  id                     String                   @id @default(uuid())
  name                   String
  um                     String?                  @default("UN")
  categoryId             String?                  @map("category_id")
  subCategoryId          String?                  @map("sub_category_id")
  createdAt              DateTime                 @map("created_at")
  updatedAt              DateTime                 @default(now()) @updatedAt @map("updated_at")
  Category               Category?                @relation(fields: [categoryId], references: [id])
  SubCategory            SubCategory?             @relation(fields: [subCategoryId], references: [id])
  RecipesIngredientsLink RecipesIngredientsLink[]

  @@map("products")
}

enum RecipeType {
  semiFinished @map("semi-finished")
  pizzaTopping @map("pizza-topping")
}

model Recipe {
  id                     String                   @id @default(uuid())
  name                   String
  type                   RecipeType               @default(semiFinished)
  description            String?
  hasVariations          Boolean                  @default(false) @map("has_variations")
  isVegetarian           Boolean                  @default(false) @map("is_vegetarian")
  isGlutenFree           Boolean                  @default(false) @map("is_gluten_free")
  createdAt              DateTime                 @map("created_at")
  updatedAt              DateTime                 @default(now()) @updatedAt @map("updated_at")
  ingredients            RecipesIngredient[]
  RecipeVariation        RecipeVariation[]
  RecipesIngredientsLink RecipesIngredientsLink[]

  @@map("recipes")
}

model RecipesIngredient {
  id           String   @id @default(uuid())
  recipeId     String   @map("recipe_id")
  ingredientId String   @map("ingredient_id")
  um           String   @db.VarChar
  quantity     String   @db.VarChar
  createdAt    DateTime @map("created_at")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")

  recipe     Recipe                   @relation(fields: [recipeId], references: [id])
  ingredient Ingredient               @relation(fields: [ingredientId], references: [id])
  links      RecipesIngredientsLink[]

  @@map("recipes_ingredients")
}

model Ingredient {
  id        String              @id @default(uuid())
  name      String              @db.VarChar
  um        String              @db.VarChar
  createdAt DateTime            @map("created_at")
  updatedAt DateTime            @default(now()) @updatedAt @map("updated_at")
  recipes   RecipesIngredient[]

  @@map("ingredients")
}

model RecipesIngredientsLink {
  id                 String  @id @default(uuid())
  recipeIngredientId String  @map("recipe_ingredient_id")
  type               String  @db.VarChar
  productId          String?
  recipeId           String?

  recipeIngredient RecipesIngredient @relation(fields: [recipeIngredientId], references: [id])
  Product          Product?          @relation(fields: [productId], references: [id])
  Recipe           Recipe?           @relation(fields: [recipeId], references: [id])

  @@map("recipes_ingredients_links")
}

model RecipeVariation {
  id           String   @id @default(uuid())
  recipeId     String   @map("recipe_id")
  name         String
  description  String
  factorType   String   @map("factor_type")
  factorNumber Float    @map("factor_number")
  createdAt    DateTime @map("created_at")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")
  Recipe       Recipe   @relation(fields: [recipeId], references: [id])

  @@map("recipes_variations")
}

model Category {
  id            String        @id @default(uuid())
  name          String
  sortOrder     Int           @map("sort_order")
  type          String
  createdAt     DateTime      @map("created_at")
  updatedAt     DateTime      @default(now()) @updatedAt @map("updated_at")
  Products      Product[]
  SubCategories SubCategory[] @relation("CategorySubCategories")
  MenuItems     MenuItem[]

  @@map("categories")
}

model SubCategory {
  id         String     @id @default(uuid())
  name       String
  createdAt  DateTime   @map("created_at")
  updatedAt  DateTime   @default(now()) @updatedAt @map("updated_at")
  Categories Category[] @relation("CategorySubCategories")
  Product    Product[]

  @@map("sub_categories")
}

model PushSubscription {
  id             String                  @id @default(uuid())
  endpoint       String                  @unique
  expirationTime DateTime?
  p256dh         String
  auth           String
  userAgent      String?
  createdAt      DateTime                @default(now()) @map("created_at")
  events         PushNotificationEvent[]

  @@map("push_subscriptions")
}

model PushNotificationCampaign {
  id           String                  @id @default(uuid())
  title        String
  body         String
  url          String?
  status       String                  @default("draft")
  scheduledAt  DateTime?
  sentAt       DateTime?
  sendCount    Int                     @default(0)
  showCount    Int                     @default(0)
  clickCount   Int                     @default(0)
  closeCount   Int                     @default(0)
  totalDwellMs Int                     @default(0)
  createdAt    DateTime                @default(now()) @map("created_at")
  updatedAt    DateTime                @default(now()) @updatedAt @map("updated_at")
  events       PushNotificationEvent[]

  @@map("push_notification_campaigns")
}

model PushNotificationEvent {
  id             String   @id @default(uuid())
  campaignId     String   @map("campaign_id")
  subscriptionId String   @map("subscription_id")
  type           String
  dwellMs        Int?
  createdAt      DateTime @default(now()) @map("created_at")

  campaign     PushNotificationCampaign @relation(fields: [campaignId], references: [id])
  subscription PushSubscription         @relation(fields: [subscriptionId], references: [id])

  @@map("push_notification_events")
}

model MetaAdsLog {
  id             String   @id @default(uuid())
  correlationId  String?  @map("correlation_id")
  event          String?
  phone          String?
  trigger        String?
  messageText    String?  @map("message_text") @db.Text
  sent           Boolean  @default(false)
  reason         String?
  responseType   String?  @map("response_type")
  payloadPreview String?  @map("payload_preview") @db.Text
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([event])
  @@index([createdAt])
  @@map("meta_ads_logs")
}

model GroceryList {
  id              String            @id @default(uuid())
  name            String
  createdAt       DateTime          @map("created_at")
  updatedAt       DateTime          @default(now()) @updatedAt @map("updated_at")
  GroceryListItem GroceryListItem[]

  @@map("grocery_list")
}

model GroceryListItem {
  id            String      @id @default(uuid())
  createdAt     DateTime    @map("created_at")
  updatedAt     DateTime    @default(now()) @updatedAt @map("updated_at")
  groceryListId String      @map("grocery_list_id")
  GroceryList   GroceryList @relation(fields: [groceryListId], references: [id])
  name          String?
  quantity      Int
  purchased     Boolean     @default(false)

  @@map("grocery_list_items")
}

model MenuItemGroup {
  id             String    @id @default(uuid())
  key            String
  name           String
  description    String
  /// sortOrder should be 1000 for the first group, 2000 for the second, etc
  sortOrderIndex Int       @map("sort_order_index")
  visible        Boolean   @default(true)
  createdAt      DateTime  @map("created_at")
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt      DateTime? @map("deleted_at")
  deletedBy      String?   @map("deleted_by")
  featured       Boolean   @default(false)

  MenuItem MenuItem[]

  @@map("menu_item_groups")
}

model MenuItem {
  id                                 String                               @id @default(uuid())
  name                               String
  description                        String
  longDescription                    String?                              @map("long_description")
  ingredients                        String
  categoryId                         String                               @map("category_id")
  Category                           Category                             @relation(fields: [categoryId], references: [id])
  basePriceAmount                    Float                                @map("base_price_amount")
  visible                            Boolean
  active                             Boolean                              @default(true)
  upcoming                           Boolean                              @default(false)
  mogoId                             String                               @map("mogo_id")
  createdAt                          DateTime                             @map("created_at")
  updatedAt                          DateTime                             @default(now()) @updatedAt @map("updated_at")
  deletedAt                          DateTime?                            @map("deleted_at")
  deletedBy                          String?                              @map("deleted_by")
  tags                               MenuItemTag[]
  /// this track the position inside the menu
  sortOrderIndex                     Int                                  @default(0) @map("sort_order_index")
  notesPublic                        String?                              @map("note_public")
  slug                               String?                              @map("slug")
  MenuItemLike                       MenuItemLike[]
  MenuItemShare                      MenuItemShare[]
  MenuItemInterestEvent              MenuItemInterestEvent[]
  imageId                            String?                              @map("image_id")
  MenuItemImage                      MenuItemImage?                       @relation(fields: [imageId], references: [id])
  MenuItemNote                       MenuItemNote[]
  MenuItemSellingPriceVariation      MenuItemSellingPriceVariation[]
  MenuItemCostVariation              MenuItemCostVariation[]
  priceVariations                    MenuItemPriceVariation[]
  MenuItemGroup                      MenuItemGroup?                       @relation(fields: [menuItemGroupId], references: [id])
  menuItemGroupId                    String?                              @map("menu_item_group_id")
  MenuItemSellingPriceVariationAudit MenuItemSellingPriceVariationAudit[]
  MenuItemGalleryImage               MenuItemGalleryImage[]

  @@map("menu_items")
}

model MenuItemImage {
  id               String     @id @default(uuid())
  /// "secure_url": "https://res.cloudinary.com/dy8gw8ahl/image/upload/v1723138046/rvife3elpmmjojlnwypm.jpg",
  secureUrl        String?    @map("secure_url")
  /// "asset_folder": "cardapio"
  assetFolder      String?    @map("asset_folder")
  originalFileName String?    @map("original_file_name")
  /// "display_name": "margherita"
  displayName      String?    @map("display_name")
  height           Float?     @map("height")
  width            Float?     @map("width")
  /// "thumbnail_url": "https://res.cloudinary.com/dy8gw8ahl/image/upload/c_limit,h_60,w_90/v1723138046/rvife3elpmmjojlnwypm.jpg"
  thumbnailUrl     String?    @map("thumbnail_url")
  format           String?    @map("format")
  publicId         String?    @map("public_id")
  MenuItem         MenuItem[]

  @@map("menu_items_image")
}

model MenuItemGalleryImage {
  id               String   @id @default(uuid())
  menuItemId       String   @map("menu_item_id")
  menuItem         MenuItem @relation(fields: [menuItemId], references: [id])
  secureUrl        String?  @map("secure_url")
  assetId          String?  @map("asset_id")
  assetFolder      String?  @map("asset_folder")
  originalFileName String?  @map("original_file_name")
  displayName      String?  @map("display_name")
  height           Float?   @map("height")
  width            Float?   @map("width")
  thumbnailUrl     String?  @map("thumbnail_url")
  format           String?  @map("format")
  publicId         String?  @map("public_id")
  isPrimary        Boolean  @default(false) /// Para destacar uma imagem principal

  @@map("menu_item_gallery_images")
}

/// to remove  DO NOT USE
model MenuItemVariation {
  id                     String                   @id @default(uuid())
  key                    String?                  @map("key")
  name                   String
  sortOrderIndex         Int                      @default(0) @map("sort_order_index")
  createdAt              DateTime                 @map("created_at")
  updatedAt              DateTime                 @default(now()) @updatedAt @map("updated_at")
  MenuItemPriceVariation MenuItemPriceVariation[]

  @@map("menu_item_variations")
}

/// to remove  DO NOT USE
model MenuItemPriceVariation {
  id                  String             @id @default(uuid())
  MenuItem            MenuItem?          @relation(fields: [menuItemId], references: [id])
  menuItemId          String?            @map("menu_item_id")
  MenuItemVariation   MenuItemVariation? @relation(fields: [menuItemVariationId], references: [id])
  menuItemVariationId String?            @map("menu_item_variation_id")
  label               String
  basePrice           Float              @default(0) @map("base_price")
  amount              Float
  discountPercentage  Float              @map("discount_percentage")
  showOnCardapio      Boolean            @default(false) @map("show_on_cardapio")
  showOnCardapioAt    DateTime?          @map("show_on_cardapio_at")
  createdAt           DateTime           @map("created_at")
  updatedAt           DateTime           @default(now()) @updatedAt @map("updated_at")
  updatedBy           String?            @map("updated_by")
  latestAmount        Float              @default(0) @map("latest_amount")
  MenuItemSize        MenuItemSize?      @relation(fields: [menuItemSizeId], references: [id])
  menuItemSizeId      String?            @map("menu_item_size_id")

  @@map("menu_item_price_variations")
}

model MenuItemSellingPriceVariation {
  id                       String                  @id @default(uuid())
  MenuItem                 MenuItem?               @relation(fields: [menuItemId], references: [id])
  menuItemId               String?                 @map("menu_item_id")
  MenuItemSize             MenuItemSize?           @relation(fields: [menuItemSizeId], references: [id])
  menuItemSizeId           String?                 @map("menu_item_size_id")
  MenuItemSellingChannel   MenuItemSellingChannel? @relation(fields: [menuItemSellingChannelId], references: [id])
  menuItemSellingChannelId String?                 @map("menu_item_selling_channel_id")
  /// efetivo valor de venda publico do cardapio
  priceAmount              Float                   @map("price_amount")
  /// a percentagem do profito realizado com o efetivo valor de venda
  profitActualPerc         Float                   @default(0) @map("profit_actual_perc")
  /// o valor calculado com base a formula do DNA
  priceExpectedAmount      Float                   @default(0) @map("price_expected_amount")
  /// a percentagem do profito desejada para o canal de venda
  profitExpectedPerc       Float                   @default(0) @map("profit_expected_perc")
  discountPercentage       Float                   @map("discount_percentage")
  showOnCardapio           Boolean                 @default(false) @map("show_on_cardapio")
  showOnCardapioAt         DateTime?               @map("show_on_cardapio_at")
  createdAt                DateTime                @map("created_at")
  updatedAt                DateTime                @default(now()) @updatedAt @map("updated_at")
  updatedBy                String?                 @map("updated_by")
  previousPriceAmount      Float                   @default(0) @map("previous_price_amount")

  @@map("menu_item_selling_prices")
}

model MenuItemSellingPriceVariationAudit {
  id                         String                 @id @default(uuid())
  MenuItem                   MenuItem               @relation(fields: [menuItemId], references: [id])
  menuItemId                 String                 @map("menu_item_id")
  MenuItemSize               MenuItemSize           @relation(fields: [menuItemSizeId], references: [id])
  menuItemSizeId             String                 @map("menu_item_size_id")
  MenuItemSellingChannel     MenuItemSellingChannel @relation(fields: [menuItemSellingChannelId], references: [id])
  menuItemSellingChannelId   String                 @map("menu_item_selling_channel_id")
  recipeCostAmount           Float                  @default(0) @map("recipe_cost_amount")
  packagingCostAmount        Float                  @default(0) @map("packaging_cost_amount")
  doughCostAmount            Float                  @default(0) @map("dough_cost_amount")
  wasteCostAmount            Float                  @default(0) @map("waste_cost_amount")
  dnaPerc                    Float                  @default(0) @map("dna_perc")
  sellingPriceExpectedAmount Float                  @default(0) @map("selling_price_expected_amount")
  profitExpectedPerc         Float                  @default(0) @map("profit_expected_perc")
  sellingPriceActualAmount   Float                  @default(0) @map("selling_price_actual_amount")
  profitActualPerc           Float                  @default(0) @map("profit_actual_perc")
  createdAt                  DateTime               @map("created_at")
  updatedAt                  DateTime               @default(now()) @updatedAt @map("updated_at")
  updatedBy                  String                 @map("updated_by")

  @@map("menu_item_selling_prices_audit")
}

model MenuItemSellingChannel {
  id                                 String                               @id @default(uuid())
  key                                String                               @map("key")
  name                               String
  feeAmount                          Float                                @default(0) @map("fee_amount")
  taxPerc                            Float                                @default(0) @map("tax_perc")
  onlinePaymentTaxPerc               Float                                @default(0) @map("online_payment_tax_perc")
  targetMarginPerc                   Float                                @default(0) @map("target_margin_perc")
  isMarketplace                      Boolean                              @default(false) @map("is_marketplace")
  sortOrderIndex                     Int                                  @default(0) @map("sort_order_index")
  MenuItemSellingPriceVariation      MenuItemSellingPriceVariation[]
  MenuItemSellingPriceVariationAudit MenuItemSellingPriceVariationAudit[]

  @@map("menu_item_selling_channels")
}

model MenuItemCostVariation {
  id                 String        @id @default(uuid())
  MenuItem           MenuItem      @relation(fields: [menuItemId], references: [id])
  menuItemId         String        @map("menu_item_id")
  costAmount         Float         @default(0) @map("cost_amount")
  createdAt          DateTime      @map("created_at")
  updatedAt          DateTime      @default(now()) @updatedAt @map("updated_at")
  updatedBy          String?       @map("updated_by")
  previousCostAmount Float         @default(0) @map("previous_cost_amount")
  MenuItemSize       MenuItemSize? @relation(fields: [menuItemSizeId], references: [id])
  menuItemSizeId     String?       @map("menu_item_size_id")

  @@unique([menuItemId, menuItemSizeId])
  @@map("menu_item_cost_variations")
}

model DnaEmpresaSettings {
  id                     String   @id @default(uuid())
  description            String?
  faturamentoBrutoAmount Float    @default(0) @map("faturamento_bruto_amount")
  custoFixoAmount        Float    @default(0) @map("custo_fixo_amount")
  custoFixoPerc          Float    @default(0) @map("custo_fixo_perc")
  taxaCartaoPerc         Float    @default(0) @map("taxa_cartao_perc")
  impostoPerc            Float    @default(0) @map("imposto_perc")
  dnaPerc                Float    @default(0) @map("dna_perc")
  wastePerc              Float    @default(0) @map("waste_perc")
  custoVariavelAmount    Float    @default(0) @map("custo_variavel_amount")
  custoVariavelPerc      Float    @default(0) @map("custo_variavel_perc")
  isSnapshot             Boolean  @default(false) @map("is_snapshot")
  createdAt              DateTime @default(now()) @map("created_at")

  @@map("dna_empresa_settings")
}

model FinancialSummary {
  id          String  @id @default(uuid())
  // Snapshot/controle
  isSnapshot  Boolean @default(false) @map("is_snapshot")
  description String?

  receitaBrutaAmount     Float @default(0) @map("receita_bruta_amount")
  vendaCartaoAmount      Float @default(0) @map("venda_cartao_amount")
  vendaCartaoPerc        Float @default(0) @map("venda_cartao_perc")
  taxaCartaoPerc         Float @default(0) @map("taxa_cartao_perc")
  taxaCartaoAmount       Float @default(0) @map("taxa_cartao_amount")
  impostoPerc            Float @default(0) @map("imposto_perc")
  impostoAmount          Float @default(0) @map("imposto_amount")
  vendaMarketplaceAmount Float @default(0) @map("venda_marketplace_amount")
  taxaMarketplacePerc    Float @default(0) @map("taxa_marketplace_perc")
  taxaMarketplaceAmount  Float @default(0) @map("taxa_marketplace_amount")
  receitaLiquidaAmount   Float @default(0) @map("receita_liquida_amount")
  custoFixoAmount        Float @default(0) @map("custo_fixo_amount")
  custoFixoPerc          Float @default(0) @map("custo_fixo_perc")
  custoVariavelAmount    Float @default(0) @map("custo_variavel_amount")
  custoVariavelPerc      Float @default(0) @map("custo_variavel_perc")

  pontoEquilibrioAmount Float @default(0) @map("ponto_equilibrio_amount") /// meta mínima

  ticketMedio Float @default(0) @map("ticket_medio")

  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  FinancialDailyGoal FinancialDailyGoal[]

  // Índices alinhados às consultas
  @@index([isSnapshot, createdAt], map: "fs_is_snapshot_created_at_idx")
  @@map("financial_summaries")
}

model FinancialDailyGoalSettings {
  id String @id @default(uuid())

  targetProfitPerc Float @default(0) @map("target_profit_perc")

  // % sales distribution by weekday
  salesDistributionPctDay01 Float @default(0) @map("sales_distribution_pct_day_01") // Quarta
  salesDistributionPctDay02 Float @default(0) @map("sales_distribution_pct_day_02") // Quinta
  salesDistributionPctDay03 Float @default(0) @map("sales_distribution_pct_day_03") // Sexta
  salesDistributionPctDay04 Float @default(0) @map("sales_distribution_pct_day_04") // Sábado
  salesDistributionPctDay05 Float @default(0) @map("sales_distribution_pct_day_05") // Domingo

  @@map("financial_daily_goal_settings")
}

model FinancialDailyGoal {
  id String @id @default(uuid())

  financialSummaryId String?           @map("financial_summary_id")
  financialSummary   FinancialSummary? @relation(fields: [financialSummaryId], references: [id])

  // NOVO: apenas um registro "válido" por vez
  isActive Boolean @default(true) @map("is_active")

  targetProfitPerc Float @default(0) @map("target_profit_perc")

  salesDistributionPctDay01 Float @default(0) @map("sales_distribution_pct_day_01")
  salesDistributionPctDay02 Float @default(0) @map("sales_distribution_pct_day_02")
  salesDistributionPctDay03 Float @default(0) @map("sales_distribution_pct_day_03")
  salesDistributionPctDay04 Float @default(0) @map("sales_distribution_pct_day_04")
  salesDistributionPctDay05 Float @default(0) @map("sales_distribution_pct_day_05")

  minSalesGoalAmountDia01 Float @default(0) @map("min_sales_goal_amount_dia_01")
  minSalesGoalAmountDia02 Float @default(0) @map("min_sales_goal_amount_dia_02")
  minSalesGoalAmountDia03 Float @default(0) @map("min_sales_goal_amount_dia_03")
  minSalesGoalAmountDia04 Float @default(0) @map("min_sales_goal_amount_dia_04")
  minSalesGoalAmountDia05 Float @default(0) @map("min_sales_goal_amount_dia_05")

  targetSalesGoalAmountDia01 Float @default(0) @map("target_sales_goal_amount_dia_01")
  targetSalesGoalAmountDia02 Float @default(0) @map("target_sales_goal_amount_dia_02")
  targetSalesGoalAmountDia03 Float @default(0) @map("target_sales_goal_amount_dia_03")
  targetSalesGoalAmountDia04 Float @default(0) @map("target_sales_goal_amount_dia_04")
  targetSalesGoalAmountDia05 Float @default(0) @map("target_sales_goal_amount_dia_05")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Índices
  // Se você usa isActive no loader:
  @@index([isActive, createdAt], map: "fdg_is_active_created_at_idx")
  // Para consultas por resumo (histórico/relatório):
  @@index([financialSummaryId, createdAt], map: "fdg_summary_created_at_idx")
  @@map("financial_daily_goals")
}

model FinancialMonthlyClose {
  id String @id @default(uuid())

  referenceMonth Int @map("reference_month")
  referenceYear  Int @map("reference_year")

  receitaExtratoBancoAmount Float @default(0) @map("receita_extrato_banco_amount")
  receitaDinheiroAmount     Float @default(0) @map("receita_dinheiro_amount")
  receitaBrutaAmount        Float @default(0) @map("receita_bruta_amount")
  faturamentoMensalAmount   Float @default(0) @map("faturamento_mensal_amount")
  vendaCartaoAmount         Float @default(0) @map("venda_cartao_amount")
  vendaCartaoPerc           Float @default(0) @map("venda_cartao_perc")
  taxaCartaoPerc            Float @default(0) @map("taxa_cartao_perc")
  taxaCartaoAmount          Float @default(0) @map("taxa_cartao_amount")
  impostoPerc               Float @default(0) @map("imposto_perc")
  impostoAmount             Float @default(0) @map("imposto_amount")
  vendaMarketplaceAmount    Float @default(0) @map("venda_marketplace_amount")
  taxaMarketplacePerc       Float @default(0) @map("taxa_marketplace_perc")
  taxaMarketplaceAmount     Float @default(0) @map("taxa_marketplace_amount")
  receitaLiquidaAmount      Float @default(0) @map("receita_liquida_amount")

  // Custos fixos principais (espelham o formulário)
  custoFixoPlanoSaudeAmount           Float @default(0) @map("custo_fixo_plano_saude_amount")
  custoFixoFolhaFuncionariosAmount    Float @default(0) @map("custo_fixo_folha_funcionarios_amount")
  custoFixoProlaboreAmount            Float @default(0) @map("custo_fixo_prolabore_amount")
  custoFixoRetiradaProlaboreAmount    Float @default(0) @map("custo_fixo_retirada_prolabore_amount")
  custoFixoRetiradaResultadoAmount    Float @default(0) @map("custo_fixo_retirada_resultado_amount")
  custoFixoParcelaFinanciamentoAmount Float @default(0) @map("custo_fixo_parcela_financiamento_amount")
  custoFixoAssessoriaMarketingAmount  Float @default(0) @map("custo_fixo_assessoria_marketing_amount")
  custoFixoTrafegoPagoAmount          Float @default(0) @map("custo_fixo_trafego_pago_amount")
  custoFixoFaturaCartaoAmount         Float @default(0) @map("custo_fixo_fatura_cartao_amount")
  custoFixoOutrosAmount               Float @default(0) @map("custo_fixo_outros_amount")
  // Campos antigos mantidos para compatibilidade de dados legados
  custoFixoFolhaAmount                Float @default(0) @map("custo_fixo_folha_amount")
  custoFixoRetiradaLucroAmount        Float @default(0) @map("custo_fixo_retirada_lucro_amount")
  custoFixoAluguelAmount              Float @default(0) @map("custo_fixo_aluguel_amount")
  custoFixoEnergiaAmount              Float @default(0) @map("custo_fixo_energia_amount")
  custoFixoSoftwareAmount             Float @default(0) @map("custo_fixo_software_amount")
  custoFixoMarketingAmount            Float @default(0) @map("custo_fixo_marketing_amount")

  // Custos variáveis principais (espelham o formulário)
  custoVariavelInsumosAmount   Float @default(0) @map("custo_variavel_insumos_amount")
  custoVariavelEntregaAmount   Float @default(0) @map("custo_variavel_entrega_amount")
  custoVariavelImpostosAmount  Float @default(0) @map("custo_variavel_impostos_amount")
  custoVariavelOutrosAmount    Float @default(0) @map("custo_variavel_outros_amount")
  custoVariavelTotalAmount     Float @default(0) @map("custo_variavel_total_amount")
  custoVariavelMarketingAmount Float @default(0) @map("custo_variavel_marketing_amount")

  entradasNaoOperacionaisAmount Float @default(0) @map("entrada_nao_operacional_amount")
  saidasNaoOperacionaisAmount   Float @default(0) @map("saida_nao_operacional_amount")

  custoFixoTotalAmount   Float @default(0) @map("custo_fixo_total_amount")
  custoFixoPerc          Float @default(0) @map("custo_fixo_perc")
  custoVariavelPerc      Float @default(0) @map("custo_variavel_perc")
  pontoEquilibrioAmount  Float @default(0) @map("ponto_equilibrio_amount")
  margemContribAmount    Float @default(0) @map("margem_contrib_amount")
  margemContribPerc      Float @default(0) @map("margem_contrib_perc")
  resultadoLiquidoAmount Float @default(0) @map("resultado_liquido_amount")
  resultadoLiquidoPerc   Float @default(0) @map("resultado_liquido_perc")

  notes String? @map("notes") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([referenceYear, referenceMonth], map: "fmc_year_month_unique")
  @@index([referenceYear, referenceMonth], map: "fmc_year_month_idx")
  @@map("financial_monthly_closes")
}

model MenuItemSize {
  id                                 String                               @id @default(uuid())
  key                                String?                              @map("key")
  name                               String
  nameAbbreviated                    String?                              @map("name_abbreviated")
  nameShort                          String?                              @map("name_short") // <- nova coluna
  description                        String?                              @map("description")
  sortOrderIndex                     Int                                  @default(0) @map("sort_order_index")
  createdAt                          DateTime                             @map("created_at")
  updatedAt                          DateTime                             @default(now()) @updatedAt @map("updated_at")
  pizzaDoughCostAmount               Float                                @default(0) @map("pizza_dough_cost_amount")
  packagingCostAmount                Float                                @default(0) @map("packaging_cost_amount")
  // visivel no cardapio
  visible                            Boolean                              @default(true)
  // visivel para administracao
  visibleAdmin                       Boolean                              @default(true) @map("visible_admin")
  maxToppingsAmount                  Float                                @default(0) @map("max_toppings_amount")
  maxToppingsAmountDescription       String?                              @map("max_toppings_amount_description") // <- nova coluna
  maxServeAmount                     Float                                @default(0) @map("max_serve_amount") // <- nova coluna
  maxServeAmountDescription          String?                              @map("max_serve_amount_description") // <- nova coluna
  group                              String?
  MenuItemPriceVariation             MenuItemPriceVariation[]
  MenuItemSellingPriceVariation      MenuItemSellingPriceVariation[]
  MenuItemCostVariation              MenuItemCostVariation[]
  MenuItemSellingPriceVariationAudit MenuItemSellingPriceVariationAudit[]

  @@map("menu_item_sizes")
}

model MenuItemLike {
  id         String    @id @default(uuid())
  MenuItem   MenuItem? @relation(fields: [menuItemId], references: [id])
  menuItemId String?   @map("menu_item_id")
  sessionId  String?   @map("session_id")
  Session    Session?  @relation(fields: [sessionId], references: [id])
  amount     Float     @default(0) @map("amount")
  createdAt  DateTime  @map("created_at")
  updatedAt  DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt  DateTime? @map("deleted_at")

  @@map("menu_item_likes")
}

model MenuItemShare {
  id         String    @id @default(uuid())
  MenuItem   MenuItem? @relation(fields: [menuItemId], references: [id])
  menuItemId String?   @map("menu_item_id")
  sessionId  String?   @map("session_id")
  Session    Session?  @relation(fields: [sessionId], references: [id])
  createdAt  DateTime  @map("created_at")
  updatedAt  DateTime  @default(now()) @updatedAt @map("updated_at")

  @@map("menu_item_shares")
}

model RateLimitBucket {
  id          String   @id @default(uuid())
  key         String   @unique
  count       Int      @default(0)
  windowStart DateTime @map("window_start")
  expiresAt   DateTime @map("expires_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([expiresAt])
  @@map("rate_limit_buckets")
}

model MenuItemInterestEvent {
  id         String   @id @default(uuid())
  menuItemId String   @map("menu_item_id")
  MenuItem   MenuItem @relation(fields: [menuItemId], references: [id])
  clientId   String?  @map("client_id")
  type       String   @db.VarChar
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([menuItemId, type, createdAt])
  @@index([clientId])
  @@map("menu_item_interest_events")
}

/// here we can manage: featured (recommended), vegetarian, kids, meat
model MenuItemTag {
  id         String    @id @default(uuid())
  MenuItem   MenuItem? @relation(fields: [menuItemId], references: [id])
  menuItemId String?   @map("menu_item_id")
  Tag        Tag?      @relation(fields: [tagId], references: [id])
  tagId      String?   @map("tag_id")
  deletedAt  DateTime? @map("deleted_at")
  createdAt  DateTime  @map("created_at")
  updatedAt  DateTime  @default(now()) @updatedAt @map("updated_at")

  @@map("menu_item_tags")
}

model AdminNavigationClick {
  id            String   @id @default(uuid())
  href          String   @unique
  title         String
  groupTitle    String?  @map("group_title")
  pinned        Boolean  @default(false)
  count         Int      @default(0)
  lastClickedAt DateTime @map("last_clicked_at")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("admin_navigation_clicks")
}

model Tag {
  id             String        @id @default(uuid())
  name           String
  public         Boolean       @default(false)
  colorHEX       String        @default("#e0e0e0") @map("color_hex")
  featuredFilter Boolean       @default(false) @map("featured_filter")
  sortOrderIndex Int           @default(0) @map("sort_order_index")
  deletedAt      DateTime?     @map("deleted_at")
  createdAt      DateTime      @map("created_at")
  updatedAt      DateTime      @default(now()) @updatedAt @map("updated_at")
  MenuItemTag    MenuItemTag[]

  @@map("tags")
}

model MenuItemNote {
  id         String    @id @default(uuid())
  MenuItem   MenuItem? @relation(fields: [menuItemId], references: [id])
  menuItemId String?   @map("menu_item_id")
  Note       Note?     @relation(fields: [noteId], references: [id])
  noteId     String?   @map("note_id")
  deletedAt  DateTime? @map("deleted_at")
  createdAt  DateTime  @map("created_at")
  updatedAt  DateTime  @default(now()) @updatedAt @map("updated_at")

  @@map("menu_item_notes")
}

model ImportCustomerServicePizzaMediumCombinations {
  id                   String    @id @default(uuid())
  topping1             String    @map("topping_1")
  ingredient1          String    @map("ingredient_1")
  topping2             String    @map("topping_2")
  ingredient2          String    @map("ingredient_2")
  sellingPriceAmount   Float     @map("selling_price_amount")
  breakEvenPriceAmount Float     @map("break_even_price_amount")
  realMarginPerc       Float     @map("real_margin_perc")
  createdAt            DateTime  @map("created_at")
  updatedAt            DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt            DateTime? @map("deleted_at")

  @@map("import_customer_service_pizza_medium_combinations")
}

model ImportCustomerServicePizzaBiggerCombinations {
  id                   String    @id @default(uuid())
  topping1             String    @map("topping_1")
  ingredient1          String    @map("ingredient_1")
  topping2             String    @map("topping_2")
  ingredient2          String    @map("ingredient_2")
  topping3             String    @map("topping_3")
  ingredient3          String    @map("ingredient_3")
  topping4             String    @map("topping_4")
  ingredient4          String    @map("ingredient_4")
  sellingPriceAmount   Float     @map("selling_price_amount")
  breakEvenPriceAmount Float     @map("break_even_price_amount")
  realMarginPerc       Float     @map("real_margin_perc")
  createdAt            DateTime  @map("created_at")
  updatedAt            DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt            DateTime? @map("deleted_at")

  @@map("import_customer_service_pizza_bigger_combinations")
}

model Note {
  id           String         @id @default(uuid())
  name         String
  public       Boolean        @default(false)
  validFrom    DateTime?      @map("valid_from")
  validTo      DateTime?      @map("valid_to")
  createdAt    DateTime       @map("created_at")
  updatedAt    DateTime       @default(now()) @updatedAt @map("updated_at")
  MenuItemNote MenuItemNote[]

  @@map("notes")
}

model Announcement {
  id        String    @id @default(uuid())
  name      String
  public    Boolean   @default(false)
  validFrom DateTime? @map("valid_from")
  validTo   DateTime? @map("valid_to")
  createdAt DateTime  @map("created_at")
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("announcements")
}

model Setting {
  id        String   @id @default(uuid())
  context   String
  name      String
  type      String
  value     String
  createdAt DateTime @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("settings")
}

// model OrderDeliveryTimeLeftOrdersInbound {
//   id          String    @id @default(uuid())
//   orderNumber String    @map("order_number")
//   /// rawData: JSON format of order object
//   rawData     String?   @map("raw_data")
//   archivedAt  DateTime? @map("archived_at")
//   createdAt   DateTime  @map("created_at")
//   updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")

//   @@map("odtl_orders_inbound")
// }

model MogoOrdersInbound {
  id           String    @id @default(uuid())
  orderNumber  String    @map("order_number")
  orderDateStr String?   @map("order_date_str")
  orderTimeStr String?   @map("order_time_str")
  /// rawData: JSON format of order object
  rawData      String?   @map("raw_data")
  archivedAt   DateTime? @map("archived_at")
  createdAt    DateTime  @map("created_at")
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at")

  @@map("mogo_orders_inbound")
}

model Session {
  id            String          @id @default(uuid())
  userId        String?         @map("user_id")
  payload       String?
  createdAt     DateTime        @map("created_at")
  updatedAt     DateTime        @default(now()) @updatedAt @map("updated_at")
  MenuItemLike  MenuItemLike[]
  MenuItemShare MenuItemShare[]
  PostLike      PostLike[]
  PostShare     PostShare[]

  @@map("sessions")
}

model ImportProfile {
  id            String          @id @default(uuid())
  name          String
  description   String?
  table         String
  domainClass   String?         @map("domain_class")
  type          String          @default("csv")
  createdAt     DateTime        @map("created_at")
  updatedAt     DateTime        @default(now()) @updatedAt @map("updated_at")
  ImportSession ImportSession[]

  @@map("import_profiles")
}

model ImportSession {
  id                                 String                               @id @default(uuid())
  ImportProfile                      ImportProfile?                       @relation(fields: [importProfileId], references: [id])
  importProfileId                    String?                              @map("import_profile_id")
  description                        String?
  transformed                        Boolean                              @default(false)
  loaded                             Boolean                              @default(false)
  createdAt                          DateTime                             @map("created_at")
  updatedAt                          DateTime                             @default(now()) @updatedAt @map("updated_at")
  ImportSessionRecord                ImportSessionRecord[]
  ImportSessionRecordBankTransaction ImportSessionRecordBankTransaction[]

  @@map("import_sessions")
}

model ImportSessionRecord {
  id              String        @id @default(uuid())
  importSessionId String        @map("import_session_id")
  importSession   ImportSession @relation(fields: [importSessionId], references: [id])
  data            Json // Armazena os dados de cada linha do arquivo como JSON
  createdAt       DateTime      @map("created_at")
  updatedAt       DateTime      @default(now()) @updatedAt @map("updated_at")

  @@map("import_sessions_records")
}

model MenuEngineeringImport {
  id        String                      @id @default(uuid())
  month     Int
  year      Int
  source    String?                     @map("source")
  createdAt DateTime                    @default(now()) @map("created_at")
  updatedAt DateTime                    @default(now()) @updatedAt @map("updated_at")
  items     MenuEngineeringImportItem[]

  @@unique([month, year])
  @@map("menu_engineering_imports")
}

model MenuEngineeringImportItem {
  id        String   @id @default(uuid())
  importId  String   @map("import_id")
  topping   String
  quantity  Int
  value     Float
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  import MenuEngineeringImport @relation(fields: [importId], references: [id], onDelete: Cascade)

  @@index([importId])
  @@map("menu_engineering_import_items")
}

model ImportSessionRecordBankTransaction {
  id              String        @id @default(uuid())
  importSessionId String        @map("import_session_id")
  importSession   ImportSession @relation(fields: [importSessionId], references: [id])
  type            String
  date            DateTime
  amount          Float
  description     String
  bankName        String        @map("bank_name")
  createdAt       DateTime      @map("created_at")
  updatedAt       DateTime      @default(now()) @updatedAt @map("updated_at")

  @@map("import_sessions_records_banks_transactions")
}

model BankTransaction {
  id                 String   @id @default(uuid())
  type               String
  date               DateTime
  amount             Float
  description        String
  bankName           String   @map("bank_name")
  hashRecord         String   @map("hash_record")
  /// esse é o ID que será chave para vincular a uma conta contabil
  hashTransactionRef String   @map("hash_transaction_ref")
  day                Int
  month              Int
  year               Int
  createdAt          DateTime @map("created_at")
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("banks_transactions")
}

model HashTransactionRefFinanceAccount {
  id                 String          @id @default(uuid())
  hashTransactionRef String          @map("hash_transaction_ref")
  financeAccountId   String?         @map("finance_account_id")
  financeAccount     FinanceAccount? @relation(fields: [financeAccountId], references: [id])

  createdAt DateTime @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("hash_transaction_refs_finance_accounts")
}

model FinanceAccount {
  id    String @id @default(uuid())
  name  String
  group String

  createdAt                        DateTime                           @map("created_at")
  updatedAt                        DateTime                           @default(now()) @updatedAt @map("updated_at")
  HashTransactionRefFinanceAccount HashTransactionRefFinanceAccount[]

  @@map("finance_accounts")
}

model HrJobFunction {
  id          String         @id @default(uuid())
  name        String
  description String?
  openings    HrJobOpening[]

  @@map("hr_job_functions")
}

/// Vaga publicada
model HrJobOpening {
  id                          String                @id @default(uuid())
  title                       String
  isActive                    Boolean               @default(true) @map("is_active")
  description                 String?               @map("description")
  /// registrar a proposta que o consultor informa
  financeProposalByConsultant String?               @map("finance_proposal_by_consultant")
  // registrar a proposta efetevimante oferecida
  financeProposalToOffer      String?               @map("finance_proposal_to_offer")
  note                        String?
  createdAt                   DateTime              @default(now()) @map("created_at")
  form                        HrJobApplicationForm?
  applications                HrJobApplication[]
  function                    HrJobFunction         @relation(fields: [functionId], references: [id])
  functionId                  String                @map("function_id")

  @@map("hr_job_openings")
}

/// Formulário vinculado à vaga
model HrJobApplicationForm {
  id           String               @id @default(uuid())
  jobOpening   HrJobOpening?        @relation(fields: [jobOpeningId], references: [id])
  jobOpeningId String?              @unique @map("job_opening_id")
  fields       HrApplicationField[]

  @@map("hr_job_application_forms")
}

/// Campos definidos no formulário
model HrApplicationField {
  id       String               @id @default(uuid())
  form     HrJobApplicationForm @relation(fields: [formId], references: [id])
  formId   String               @map("form_id")
  label    String
  type     String // ex: text, textarea, select, etc.
  required Boolean              @default(false)

  @@map("hr_application_fields")
}

/// Candidatura de um candidato
model HrJobApplication {
  id            String                @id @default(uuid())
  jobOpening    HrJobOpening          @relation(fields: [jobOpeningId], references: [id])
  jobOpeningId  String                @map("job_opening_id")
  answers       HrApplicationAnswer[]
  status        String                @default("PENDING")
  interview     HrInterview?
  proposal      HrHiringProposal?
  createdAt     DateTime              @default(now()) @map("created_at")
  notesInternal String?               @map("notes_internal")

  @@map("hr_job_applications")
}

/// Respostas individuais ao formulário
model HrApplicationAnswer {
  id            String           @id @default(uuid())
  application   HrJobApplication @relation(fields: [applicationId], references: [id])
  applicationId String           @map("application_id")
  fieldLabel    String           @map("field_label")
  answer        String

  @@map("hr_application_answers")
}

/// Dados da entrevista
model HrInterview {
  id            String           @id @default(uuid())
  application   HrJobApplication @relation(fields: [applicationId], references: [id])
  applicationId String           @unique @map("application_id")
  proposedDate  DateTime         @map("proposed_date")
  confirmedDate DateTime?        @map("confirmed_date")
  status        String           @default("PENDING")

  @@map("hr_interviews")
}

/// Proposta enviada ao candidato
model HrHiringProposal {
  id            String           @id @default(uuid())
  application   HrJobApplication @relation(fields: [applicationId], references: [id])
  applicationId String           @unique @map("application_id")
  status        String           @default("PENDING")
  sentAt        DateTime?        @map("sent_at")
  respondedAt   DateTime?        @map("responded_at")

  @@map("hr_hiring_proposals")
}

model Post {
  id        String      @id @default(uuid())
  title     String
  type      String
  caption   String
  /// featured => true show on home page
  featured  Boolean     @default(false)
  createdAt DateTime    @map("created_at")
  updatedAt DateTime    @default(now()) @updatedAt @map("updated_at")
  deletedAt DateTime?   @map("deleted_at")
  PostLike  PostLike[]
  PostShare PostShare[]

  @@map("posts")
}

model PostLike {
  id        String    @id @default(uuid())
  Post      Post?     @relation(fields: [postId], references: [id])
  postId    String?   @map("post_id")
  sessionId String?   @map("session_id")
  Session   Session?  @relation(fields: [sessionId], references: [id])
  amount    Float     @default(0) @map("amount")
  createdAt DateTime  @map("created_at")
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("post_likes")
}

model PostShare {
  id        String    @id @default(uuid())
  Post      Post?     @relation(fields: [postId], references: [id])
  postId    String?   @map("post_id")
  sessionId String?   @map("session_id")
  Session   Session?  @relation(fields: [sessionId], references: [id])
  amount    Float     @default(0) @map("amount")
  createdAt DateTime  @map("created_at")
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("post_shares")
}

model Feedback {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  sentiment   String // "positive" ou "negative", controlado pela aplicação
  imageBase64 String
  text        String?

  @@map("feedbacks")
}

model CalendarDay {
  id          String   @id @default(uuid())
  date        DateTime @unique // Data completa
  dateInt     Int      @unique @map("date_int") // Ex: 20250804
  year        Int
  month       Int
  day         Int
  weekday     Int // 0=Dom, 6=Sáb
  isWeekend   Boolean  @default(false) @map("is_weekend")
  isHoliday   Boolean  @default(false) @map("is_holiday")
  description String?
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("calendar_day")
}

model KdsDailyOrder {
  /// Cabeçalho 1 UM dia (agrega os pedidos do dia)
  id      String   @id @default(uuid())
  date    DateTime
  dateInt Int      @map("date_int")

  /// Total dos pedidos do dia (soma de orderAmount dos detalhes)
  totOrdersAmount Decimal @default(0) @map("tot_orders_amount") @db.Decimal(10, 2)

  minimumGoalProfitAmount Decimal @default(0) @map("minimum_goal_profit_amount") @db.Decimal(10, 2)
  targetGoalProfitAmount  Decimal @default(0) @map("target_goal_profit_amount") @db.Decimal(10, 2)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  details KdsDailyOrderDetail[]

  operationStatus String?   @default("pending") @map("operation_status")
  openedAt        DateTime? @map("opened_at")
  closedAt        DateTime? @map("closed_at")

  /// Um cabeçalho por dia
  @@unique([dateInt])
  @@index([dateInt])
  @@map("kds_daily_orders")
}

model KdsDailyOrderDetail {
  /// Linhas (uma por pedido) pertencentes a um dia
  id String @id @default(uuid())

  /// FK obrigatória para o cabeçalho do dia
  orderId String        @map("order_id")
  order   KdsDailyOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  /// Redundância útil para filtros/uniques por dia
  dateInt Int @map("date_int")

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  deliveredAt DateTime? @map("delivered_at")

  /// Nº da comanda (único dentro do dia)
  commandNumber Int? @map("command_number")

  /// Campos do pedido (linha)
  size        String?
  hasMoto     Boolean @default(false) @map("has_moto")
  motoValue   Decimal @default(0) @map("moto_value") @db.Decimal(10, 2)
  orderAmount Decimal @default(0) @map("order_amount") @db.Decimal(10, 2)
  channel     String?
  status      String  @default("novoPedido")

  /// Cliente (opcional)
  customerName  String? @map("customer_name")
  customerPhone String? @map("customer_phone")

  takeAway Boolean @default(false) @map("take_away")

  requestedForOven Boolean @default(false) @map("requested_for_oven")

  sortOrderIndex Int @default(0) @map("sort_order_index") // NOVO

  isVendaLivre Boolean @default(false) @map("is_venda_livre")

  isCreditCard Boolean @default(false) @map("is_credit_card")

  novoPedidoAt      DateTime?     @map("novo_pedido_at")
  emProducaoAt      DateTime?     @map("em_producao_at")
  aguardandoFornoAt DateTime?     @map("aguardando_forno_at")
  assandoAt         DateTime?     @map("assando_at")
  finalizadoAt      DateTime?     @map("finalizado_at")
  DeliveryZone      DeliveryZone? @relation(fields: [deliveryZoneId], references: [id])
  deliveryZoneId    String?       @map("delivery_zone_id")

  /// Regras/índices
  @@index([dateInt, sortOrderIndex])
  @@index([dateInt])
  @@index([commandNumber])
  @@index([orderId])
  @@map("kds_daily_order_details")
}

model DoughDailyStock {
  id        String   @id @default(uuid())
  date      DateTime
  dateInt   Int      @unique @map("date_int")
  size      String?  @map("size")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("dough_daily_stock")
}

model DeliveryZone {
  id        String   @id @default(uuid())
  name      String
  city      String
  state     String
  zipCode   String?  @map("zip_code")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  distances           DeliveryZoneDistance[]
  deliveryFees        DeliveryFee[]
  KdsDailyOrderDetail KdsDailyOrderDetail[]

  @@map("delivery_zones")
}

model CompanyLocation {
  id          String   @id @default(uuid())
  name        String
  address     String
  city        String
  state       String
  zipCode     String?  @map("zip_code")
  phoneNumber String?  @map("phone_number")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  mainLocation Boolean @default(false) @map("main_location")

  distances    DeliveryZoneDistance[]
  deliveryFees DeliveryFee[]

  @@map("company_locations")
}

model DeliveryZoneDistance {
  id                 String   @id @default(uuid())
  companyLocationId  String   @map("company_location_id")
  distanceInKm       Float    @map("distance_in_km")
  estimatedTimeInMin Int?     @map("estimated_time_in_min")
  createdAt          DateTime @default(now()) @map("created_at")

  companyLocation CompanyLocation @relation(fields: [companyLocationId], references: [id])
  DeliveryZone    DeliveryZone?   @relation(fields: [deliveryZoneId], references: [id])
  deliveryZoneId  String?         @map("delivery_zone_id")

  @@unique([deliveryZoneId, companyLocationId])
  @@map("delivery_zone_distance")
}

model DeliveryFee {
  id                String   @id @default(uuid())
  companyLocationId String   @map("pizzeria_location_id")
  amount            Float
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  companyLocation CompanyLocation @relation(fields: [companyLocationId], references: [id])
  DeliveryZone    DeliveryZone?   @relation(fields: [deliveryZoneId], references: [id])
  deliveryZoneId  String?         @map("delivery_zone_id")

  @@map("delivery_fees")
}

model DeliveryRider {
  id            String  @id @default(uuid())
  name          String
  phoneNumber   String  @map("phone_number")
  baseFeeAmount Decimal @default(0) @map("base_fee_amount") @db.Decimal(10, 2)

  @@map("delivery_riders")
}

/// -------------------------
/// Regras de resposta automática
/// -------------------------
model BotAutoResponseRule {
  id       String  @id @default(uuid()) @map("id")
  label    String  @map("label")
  trigger  String  @map("trigger")
  isRegex  Boolean @default(false) @map("is_regex")
  response String  @map("response")
  priority Int     @default(100) @map("priority")
  isActive Boolean @default(true) @map("is_active")

  activeFrom DateTime? @map("active_from")
  activeTo   DateTime? @map("active_to")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  logs BotAutoResponderLog[]

  @@index([isActive, priority], map: "idx_bot_auto_response_rules_active_priority")
  @@map("bot_auto_response_rules")
}

/// -------------------------
/// Logs de respostas
/// -------------------------
enum BotResponderEngine {
  MANUAL
  NLP
}

model BotAutoResponderLog {
  id String @id @default(uuid()) @map("id")

  // NOVOS CAMPOS
  session String? @map("session")
  engine  String? @map("engine")
  intent  String? @map("intent")
  score   Float?  @map("score")

  // EXISTENTES / RENOMEADOS
  ruleId       String?  @map("rule_id")
  matchedText  String?  @map("matched_text")
  fromNumber   String?  @map("from_number")
  toNumber     String?  @map("to_number")
  inboundBody  String   @map("inbound_body")
  outboundBody String?  @map("outbound_body")
  error        String?  @map("error")
  createdAt    DateTime @default(now()) @map("created_at")

  rule BotAutoResponseRule? @relation(fields: [ruleId], references: [id])

  @@index([ruleId], map: "idx_bot_auto_responder_logs_rule_id")
  @@index([createdAt], map: "idx_bot_auto_responder_logs_created_at")
  @@index([intent], map: "idx_bot_auto_responder_logs_intent")
  @@index([engine, createdAt], map: "idx_bot_auto_responder_logs_engine_created")
  @@map("bot_auto_responder_logs")
}

/// -------------------------
/// Configurações gerais do bot
/// -------------------------
model BotSetting {
  id                Int      @id @default(1) @map("id")
  businessStartHour Int      @default(18) @map("business_start_hour")
  businessEndHour   Int      @default(22) @map("business_end_hour")
  businessDays      String   @default("3,4,5,6,0") @map("business_days")
  offHoursMessage   String   @default("Estamos fora do horário. Voltamos em breve! 🍕") @map("off_hours_message")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  enabled           Boolean  @default(false)

  @@map("bot_settings")
}

model NlpIntent {
  id          String         @id @default(cuid())
  name        String         @unique
  label       String
  description String?        @map("description")
  isActive    Boolean        @default(true) @map("is_active")
  utterances  NlpUtterance[]
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")

  @@map("nlp_intent")
}

model NlpUtterance {
  id        String    @id @default(cuid())
  text      String
  language  String    @default("pt")
  intentId  String    @map("intent_id")
  intent    NlpIntent @relation(fields: [intentId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@map("nlp_utterance")
}

model NlpEntity {
  id          String             @id @default(cuid())
  name        String             @unique
  label       String
  description String?            @map("description")
  examples    NlpEntityExample[]
  createdAt   DateTime           @default(now()) @map("created_at")
  updatedAt   DateTime           @updatedAt @map("updated_at")

  @@map("nlp_entity")
}

model NlpEntityExample {
  id        String    @id @default(cuid())
  value     String
  synonyms  String[]
  entityId  String    @map("entity_id")
  entity    NlpEntity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@map("nlp_entity_example")
}

model NlpModel {
  id        String   @id @default(cuid())
  version   BigInt   @db.BigInt
  label     String?
  isActive  Boolean  @default(false) @map("is_active")
  language  String   @default("pt")
  artifact  Json
  trainedAt DateTime @default(now()) @map("trained_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("nlp_model")
}

model Customer {
  id          String    @id @default(uuid())
  phone       String    @unique
  name        String?
  lastOrderAt DateTime? @map("last_order_at")
  source      String    @default("erp")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  SendLogs   SendLog[]
  Engagement Engagement?
  Optout     Optout?

  @@map("customers")
}

/// Cabeçalho do pedido (não referencia Customer; relação futura por telefone)
model CustomerOrder {
  id                  String @id @default(uuid()) @map("id")
  source              String @default("csv") @map("source")
  externalOrderNumber String @map("order_number")

  customerName String  @map("customer_name")
  phoneRaw     String? @map("phone_raw")
  phoneE164    String? @map("phone_e164")

  paymentType String @map("payment_type")

  // Mantém o original do CSV (útil p/ auditoria)
  paidAtDate String @map("paid_at_date") // ex.: "31/08/2025"
  paidAtHour String @map("paid_at_hour") // ex.: "22:04:17"

  // Normalizado (combinação date+hour no fuso -03)
  paidAt DateTime @map("paid_at")

  tableLabel String? @map("table_label")
  orderTag   String? @map("order_tag")

  totalAmount Decimal @map("total_amount") @db.Decimal(12, 2)

  items CustomerOrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Evita duplicar o mesmo pedido dessa fonte (usamos os campos “brutos” do CSV p/ chave estável)
  @@unique([source, externalOrderNumber, paidAtDate, paidAtHour])
  @@index([paidAt])
  @@index([phoneE164])
  @@index([externalOrderNumber])
  @@map("customer_orders")
}

/// Itens/linhas do pedido
model CustomerOrderItem {
  id String @id @default(uuid()) @map("id")

  orderId String        @map("order_id")
  order   CustomerOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productName String  @map("product_name")
  quantity    Int     @default(1) @map("quantity")
  amount      Decimal @map("amount") @db.Decimal(10, 2)

  isFee      Boolean @default(false) @map("is_fee")
  isDiscount Boolean @default(false) @map("is_discount")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([orderId])
  @@index([productName])
  @@map("customer_order_items")
}

model Optout {
  phone     String    @id
  reason    String?
  createdAt DateTime  @default(now()) @map("created_at")
  customer  Customer? @relation(fields: [phone], references: [phone], onDelete: Cascade)

  @@map("optouts")
}

model SendLog {
  id           String    @id @default(uuid())
  phone        String
  customerId   String?   @map("customer_id")
  message      String
  status       String // queued|sent|failed
  wppMessageId String?   @map("wpp_message_id")
  error        String?
  sentAt       DateTime? @map("sent_at")
  createdAt    DateTime  @default(now()) @map("created_at")

  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)

  @@index([phone])
  @@index([customerId])
  @@map("send_logs")
}

model WppEvent {
  id        String   @id @default(uuid())
  phone     String?
  direction String // inbound|outbound
  type      String // message|status|delivery
  payload   Json
  createdAt DateTime @default(now()) @map("created_at")

  @@index([phone])
  @@map("wpp_events")
}

model Engagement {
  id             String    @id @default(uuid())
  phone          String    @unique
  lastInboundAt  DateTime? @map("last_inbound_at")
  lastOutboundAt DateTime? @map("last_outbound_at")
  firstOptinAt   DateTime? @map("first_optin_at")
  lastOptoutAt   DateTime? @map("last_optout_at")

  customer Customer? @relation(fields: [phone], references: [phone], onDelete: Cascade)

  @@map("engagements")
}

// CRM Fase 1 (snake_case models/fields)
model CrmCustomer {
  id                String  @id @default(uuid())
  phone_e164        String  @unique @db.VarChar(20)
  name              String? @db.VarChar(255)
  email             String? @db.VarChar(255)
  preferred_channel String? @map("preferred_channel") @db.VarChar(20)

  first_order_at DateTime? @map("first_order_at")
  last_order_at  DateTime? @map("last_order_at")
  orders_count   Int       @default(0) @map("orders_count")
  total_revenue  Decimal   @default(0) @map("total_revenue") @db.Decimal(12, 2)
  avg_ticket     Decimal   @default(0) @map("avg_ticket") @db.Decimal(12, 2)
  lgpd_consent   Boolean   @default(false) @map("lgpd_consent")
  consent_at     DateTime? @map("consent_at")

  delivery_address_last Json?   @map("delivery_address_last")
  neighborhood          String? @db.VarChar(255)
  city                  String? @db.VarChar(255)
  postal_code           String? @db.VarChar(20)

  gender                   String               @default("unknown") @db.VarChar(20)
  profession               String?              @db.VarChar(255)
  age_profile              String               @default("unknown") @db.VarChar(20)
  preferred_payment_method String               @default("unknown") @db.VarChar(20)
  created_at               DateTime             @default(now())
  updated_at               DateTime             @updatedAt
  events                   CrmCustomerEvent[]
  images                   CrmCustomerImage[]
  tags                     CrmCustomerTagLink[]
  sends                    CrmCampaignSend[]

  @@map("crm_customer")
}

model CrmCustomerTag {
  id         String               @id @default(uuid())
  key        String               @unique @db.VarChar(100)
  label      String?              @db.VarChar(255)
  created_at DateTime             @default(now())
  updated_at DateTime             @updatedAt
  links      CrmCustomerTagLink[]

  @@map("crm_customer_tag")
}

model CrmCustomerTagLink {
  id          String   @id @default(uuid())
  customer_id String
  tag_id      String
  created_at  DateTime @default(now())

  customer CrmCustomer    @relation(fields: [customer_id], references: [id])
  tag      CrmCustomerTag @relation(fields: [tag_id], references: [id])

  @@unique([customer_id, tag_id])
  @@index([tag_id], name: "crm_customer_tag_link_tag_id_idx")
  @@map("crm_customer_tag_link")
}

model CrmCustomerEvent {
  id          String   @id @default(uuid())
  customer_id String
  event_type  String   @db.VarChar(50)
  source      String?  @db.VarChar(100)
  external_id String?  @db.VarChar(150)
  payload     Json?
  payload_raw String?
  created_at  DateTime @default(now())

  customer CrmCustomer @relation(fields: [customer_id], references: [id])

  @@index([customer_id], name: "crm_customer_event_customer_id_idx")
  @@index([source, external_id], name: "crm_customer_event_source_external_id_idx")
  @@map("crm_customer_event")
}

model CrmCustomerImage {
  id          String   @id @default(uuid())
  customer_id String   @map("customer_id")
  url         String   @db.VarChar(2048)
  description String?  @db.VarChar(255)
  created_at  DateTime @default(now())

  customer CrmCustomer @relation(fields: [customer_id], references: [id])

  @@index([customer_id], name: "crm_customer_image_customer_id_idx")
  @@map("crm_customer_image")
}

model CrmCampaign {
  id          String            @id @default(uuid())
  name        String            @db.VarChar(255)
  description String?           @db.Text
  source      String?           @db.VarChar(100)
  external_id String?           @db.VarChar(150)
  created_at  DateTime          @default(now())
  updated_at  DateTime          @updatedAt
  sends       CrmCampaignSend[]

  @@map("crm_campaign")
}

model CrmCampaignSend {
  id          String   @id @default(uuid())
  campaign_id String
  customer_id String
  status      String?  @db.VarChar(50)
  payload     Json?
  payload_raw String?
  source      String?  @db.VarChar(100)
  external_id String?  @db.VarChar(150)
  created_at  DateTime @default(now())

  campaign CrmCampaign @relation(fields: [campaign_id], references: [id])
  customer CrmCustomer @relation(fields: [customer_id], references: [id])

  @@index([campaign_id], name: "crm_campaign_send_campaign_id_idx")
  @@index([customer_id], name: "crm_campaign_send_customer_id_idx")
  @@index([source, external_id], name: "crm_campaign_send_source_external_id_idx")
  @@map("crm_campaign_send")
}
